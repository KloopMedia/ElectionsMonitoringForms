(this["webpackJsonpkloop-forms"]=this["webpackJsonpkloop-forms"]||[]).push([[0],{121:function(e,t,n){e.exports=n(160)},126:function(e,t,n){},160:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(11),o=n.n(i),l=(n(126),n(15)),c=n.n(l),s=n(23),u=n(7),d=n(46),f=(n(55),n(31)),m=n(12),p=n(60),b=n.n(p);b.a.initializeApp({apiKey:"AIzaSyCCAhvWFvwuxDUXZ4aV-FhB_Dj-lp_frCw",authDomain:"electionsmonitor-5d008.firebaseapp.com",databaseURL:"https://electionsmonitor-5d008.firebaseio.com",projectId:"electionsmonitor-5d008",storageBucket:"electionsmonitor-5d008.appspot.com",messagingSenderId:"145410178875",appId:"1:145410178875:web:6cf434df68d3c65062811e",measurementId:"G-EXC8T9QXES"});var g=new b.a.auth.GoogleAuthProvider,h=function(){b.a.auth().signInWithPopup(g)},E=b.a,v=n(35),O=r.a.createContext(),j=function(e){var t=e.children,n=Object(a.useState)(null),i=Object(u.a)(n,2),o=i[0],l=i[1],c=Object(a.useState)(!0),s=Object(u.a)(c,2),d=s[0],f=s[1];return Object(a.useEffect)((function(){E.auth().onAuthStateChanged((function(e){l(e),f(!1);var t=E.firestore().collection("users").doc(e.uid);t.get().then((function(n){n&&n.exists||t.set({name:e.displayName,role:"independent",district:"none",email:e.email})}))}))}),[]),d?r.a.createElement(r.a.Fragment,null,"Loading..."):r.a.createElement(O.Provider,{value:{currentUser:o}},t)},w=n(193),y=n(213),x=Object(w.a)((function(e){return{root:{"& > *":{width:"40ch"}}}}));var S=function(e){var t=x(),n=r.a.useState(""),i=Object(u.a)(n,2),o=i[0],l=i[1],c=e.index,s=e.response;return Object(a.useEffect)((function(){s&&l(s)}),[s]),r.a.createElement("div",null,r.a.createElement("form",{noValidate:!0,autoComplete:"off"},r.a.createElement("h4",null,e.title),r.a.createElement(y.a,{className:t.root,id:"inputBox"+c,label:"\u041c\u043e\u0439 \u043e\u0442\u0432\u0435\u0442",value:o,onChange:function(t){l(t.target.value),e.returnAnswer(t.target.value,c,t.target.value)},disabled:!!e.locked})))},k=n(215),_=n(216),C=n(198),D=n(208),R=Object(w.a)((function(e){return{formControl:{minWidth:120}}}));function U(e){var t=R(),n=r.a.useState(""),i=Object(u.a)(n,2),o=i[0],l=i[1],c=r.a.useState(!1),s=Object(u.a)(c,2),d=s[0],f=s[1],m=e.index,p=e.response;Object(a.useEffect)((function(){p&&l(p)}),[p]);return r.a.createElement("div",null,r.a.createElement("h4",null,e.title),r.a.createElement(C.a,{className:t.formControl,disabled:!!e.locked},r.a.createElement(k.a,{id:"controlled-open-select-label"},"\u0412\u044b\u0431\u0440\u0430\u0442\u044c"),r.a.createElement(D.a,{labelId:"controlled-open-select-label",id:"select"+m,open:d,onClose:function(e){f(!1)},onOpen:function(e){f(!0)},value:o,onChange:function(t){l(t.target.value);var n=e.answers.indexOf(t.target.value);e.returnAnswer(t.target.value,m,n)}},r.a.createElement(_.a,{value:""},r.a.createElement("em",null,"None")),e.answers.map((function(e,t){return r.a.createElement(_.a,{key:t,value:e},e)})))))}var A=n(210),F=n(217),L=n(200);function I(e){var t=r.a.useState(""),n=Object(u.a)(t,2),i=n[0],o=n[1],l=e.index,c=e.response;Object(a.useEffect)((function(){c&&o(c)}),[c]);return r.a.createElement("div",null,r.a.createElement("h4",null,e.title),r.a.createElement(C.a,{const:"fieldset"},r.a.createElement(F.a,{"aria-label":e.title,name:e.title,value:i,onChange:function(t){o(t.target.value);var n=e.answers.indexOf(t.target.value);e.returnAnswer(t.target.value,l,n)}},e.answers.map((function(t,n){return r.a.createElement(L.a,{key:n,value:t,control:r.a.createElement(A.a,{color:"primary"}),label:t,disabled:!!e.locked})})))))}var q=Object(w.a)((function(e){return{container:{display:"flex",flexWrap:"wrap"},textField:{marginLeft:e.spacing(1),marginRight:e.spacing(1),width:"auto"}}}));function z(e){var t=q(),n=r.a.useState(""),i=Object(u.a)(n,2),o=i[0],l=i[1],c=e.index,s=e.response;Object(a.useEffect)((function(){s&&l(s)}),[c,s]);return r.a.createElement("div",null,r.a.createElement("h4",null,e.title),r.a.createElement("form",{className:t.container,noValidate:!0},r.a.createElement(y.a,{id:"time"+c,label:"\u0412\u0440\u0435\u043c\u044f",type:"time",value:o,onChange:function(t){l(t.target.value),e.returnAnswer(t.target.value,c,t.target.value)},className:t.textField,InputLabelProps:{shrink:!0},InputProps:{disableUnderline:!0},disabled:!!e.locked})))}var M=Object(w.a)({root:{background:"linear-gradient(45deg, #FE6B8B 30%, #FF8E53 90%)",border:0,borderRadius:3,boxShadow:"0 3px 5px 2px rgba(255, 105, 135, .3)",color:"white",height:48,padding:"0 30px"}});function N(e){M();var t=Object(a.useState)({}),n=Object(u.a)(t,2),i=n[0],o=n[1],l=Object(a.useState)({}),c=Object(u.a)(l,2),s=c[0],d=c[1],f={},m={},p=e.index,b=e.response;Object(a.useEffect)((function(){b&&o(b)}),[b]);var g=function(t){return function(n){(f=Object(v.a)({},i))[t]=n.target.value,o(f),m=Object(v.a)({},s);var a=e.answers.indexOf(n.target.value);m[t]=a,d(m),e.returnAnswer(f,p,m)}};return r.a.createElement("div",{className:"radioHorizontal"},r.a.createElement("h4",null,e.title),r.a.createElement("button",{onClick:function(){o({}),e.returnAnswer({},p)}},"clear"),r.a.createElement("div",{className:"question_item"},e.subquestion.map((function(t,n){return r.a.createElement("div",{className:"question_item_",key:n},r.a.createElement("p",null,t.q),r.a.createElement(C.a,{component:"fieldset"},r.a.createElement(F.a,{"aria-label":"position",name:"position",row:!0,value:i[n]?i[n]:"",onClick:g(n)},e.answers.map((function(t,n){return r.a.createElement(L.a,{key:n,value:t,control:r.a.createElement(A.a,{color:"primary"}),label:t,labelPlacement:"top",disabled:!!e.locked,style:{paddingLeft:5,paddingRight:5}})})))))}))))}var B=n(212),T=n(201),W=n(50),P=n.n(W),G=n(202),H=n(163),K=n(209),J=n(96),Q=n.n(J),V=n(218),X=n(64),Y=Object(m.i)((function(e){var t=Object(a.useState)([]),n=Object(u.a)(t,2),i=n[0],o=n[1],l=Object(a.useState)({}),d=Object(u.a)(l,2),f=d[0],p=d[1],b=Object(a.useState)({}),g=Object(u.a)(b,2),h=g[0],j=g[1],w=Object(a.useState)({}),y=Object(u.a)(w,2),x=y[0],k=y[1],_=Object(a.useState)(!1),C=Object(u.a)(_,2),D=C[0],R=C[1],A=Object(a.useState)(!1),F=Object(u.a)(A,2),L=F[0],q=F[1],M=Object(a.useState)(!1),W=Object(u.a)(M,2),J=W[0],Y=W[1],Z=Object(a.useState)(!1),$=Object(u.a)(Z,2),ee=$[0],te=$[1],ne=Object(a.useState)(!1),ae=Object(u.a)(ne,2),re=ae[0],ie=ae[1],oe=Object(a.useState)(!1),le=Object(u.a)(oe,2),ce=le[0],se=le[1],ue=Object(a.useState)(null),de=Object(u.a)(ue,2),fe=de[0],me=de[1],pe=Object(a.useState)(null),be=Object(u.a)(pe,2),ge=be[0],he=be[1],Ee=Object(a.useState)(!0),ve=Object(u.a)(Ee,2),Oe=(ve[0],ve[1],Object(a.useState)(null)),je=Object(u.a)(Oe,2),we=je[0],ye=je[1],xe=Object(a.useContext)(O).currentUser,Se=Object(m.g)().form;Object(a.useEffect)((function(){var e=X.parse(window.location.search);console.log(e),e.url?fetch(e.url).then((function(e){return console.log("RESPONSE",e),e.json()})).then((function(t){console.log("DATA",t),t.forEach((function(t){t.path==="/"+Se&&(me(t),fetch(t.url).then((function(e){return e.json()})).then((function(t){o(t),se(!0),e.response&&Re(t,e),t.period&&De(t),console.log(t)})))}))})):console.log("ERROR: no url detected")}),[]),Object(a.useEffect)((function(){xe&&E.firestore().collection("users").doc(xe.uid).get().then((function(e){return ye(e.data())}))}),[]);var ke=function(){var t=Object(s.a)(c.a.mark((function t(){var n,a,r;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n="",e.user.district&&(n=e.user.district),a="",e.user.polling_station&&(a=e.user.polling_station),he({answers:h,form_name:i.main_title,form_url:fe.url,identifier:i.identifier,user_id:xe.uid,user_email:xe.email,polling_station:a,district:n}),t.next=8,fetch("https://raw.githubusercontent.com/KloopMedia/ElectionsMonitoringFormsConfig/master/config.json",{cache:"no-store"}).then((function(e){_e(),console.log("internet")})).catch((function(e){ie(!0),console.log("no internet")}));case 8:return r=t.sent,t.abrupt("return",r.status>=200&&r.status<300);case 12:return t.prev=12,t.t0=t.catch(0),t.abrupt("return",!1);case 15:case"end":return t.stop()}}),t,null,[[0,12]])})));return function(){return t.apply(this,arguments)}}(),_e=function(){var e=Object(s.a)(c.a.mark((function e(){var t,n,a,r,o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t="",we.district&&(t=we.district),n="",we.polling_station&&(n=we.polling_station),a="",!("geolocation"in navigator)){e.next=11;break}return e.next=9,Ce().then((function(e){return a=e})).catch((function(e){return a=e}));case 9:e.next=12;break;case 11:a="Not Available";case 12:console.log(a),r=E.firestore().collection("responses"),o=r.doc(xe.uid),o.collection("answers").add({answers:h,identifier:i.identifier,form_name:i.main_title,form_url:fe.url,date:new Date,user_id:xe.uid,user_email:xe.email,polling_station:n,district:t,geolocation:a}).then((function(e){q(!0),te(!0)})).catch((function(e){ie(!0),console.log(e)})),console.log("data uploaded"),e.next=24;break;case 20:e.prev=20,e.t0=e.catch(0),alert(e.t0),ie(!0);case 24:case"end":return e.stop()}}),e,null,[[0,20]])})));return function(){return e.apply(this,arguments)}}(),Ce=function(){return new Promise((function(e,t){navigator.geolocation.getCurrentPosition((function(t){e({timestamp:t.timestamp,latitude:t.coords.latitude,longitude:t.coords.longitude})}),(function(e){t(e.message)}))}))},De=function(e){var t=new Date,n=new Date(e.period.start),a=new Date(e.period.finish);n>t&&e.period.before.nofill||n<t&&t<a&&e.period.in.nofill||t>a&&e.period.after.nofill?R(!0):R(!1),console.log("LOCKED ",D)},Re=function(e,t){var n=decodeURI(t.response),a=JSON.parse(n);k(a);for(var r=0,i=Object.entries(a);r<i.length;r++){var o=Object(u.a)(i[r],2),l=o[0],c=o[1],s=null;if(l===Object.keys(a)[0]&&Ue(c,l),"input"===e.questions[l].type)Ue(c,l);else if("time"===e.questions[l].type)Ue(c,l,c);else if("multiradio"===e.questions[l].type)for(var d=0,f=Object.entries(c);d<f.length;d++){var m=Object(u.a)(f[d],2),p=m[0],b=m[1],g=e.questions[l].answer.indexOf(b),E=Object(v.a)({},h[l]);E[p]=g,Ue(c,l,E)}else s=e.questions[l].answer.indexOf(c),Ue(c,l,s)}},Ue=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=Object(v.a)({},f);a[t]=e,p(a);var r=Object(v.a)({},h);r[t]=n,j(r)},Ae=function(e,t){"clickaway"!==t&&q(!1)},Fe=ce?i.questions.map((function(e,t){var n=x;return"input"===e.type?r.a.createElement(S,{key:t,index:t,title:e.title,response:n[t],returnAnswer:Ue,locked:D}):"select"===e.type?r.a.createElement(U,{key:t,index:t,title:e.title,response:n[t],answers:e.answer,returnAnswer:Ue,locked:D}):"radio"===e.type?r.a.createElement(I,{key:t,index:t,title:e.title,response:n[t],answers:e.answer,returnAnswer:Ue,locked:D}):"time"===e.type?r.a.createElement(z,{key:t,index:t,title:e.title,response:n[t],returnAnswer:Ue,locked:D}):"multiradio"===e.type?r.a.createElement(N,{key:t,index:t,title:e.title,response:n[t],subquestion:e.subquestion,answers:e.answer,returnAnswer:Ue,locked:D}):null})):null;return r.a.createElement("div",null,r.a.createElement(H.a,{variant:"h4",style:{padding:20},align:"center"},i.main_title),i.period?r.a.createElement("div",null,r.a.createElement("p",null,"\u041d\u0430\u0447\u0430\u043b\u043e: ",i.period.start),r.a.createElement("p",null,"\u041a\u043e\u043d\u0435\u0446: ",i.period.finish)):null,J?r.a.createElement(m.a,{to:"/files"}):null,r.a.createElement("div",null,Fe,re?r.a.createElement("div",{style:{paddingTop:30,paddingBottom:20}},r.a.createElement(H.a,{variant:"h5",align:"center"},"\u041d\u0435\u0442 \u0438\u043d\u0442\u0435\u0440\u043d\u0435\u0442 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f:"),r.a.createElement(H.a,{variant:"h6",align:"center"},"\u041e\u0442\u043f\u0440\u0430\u0432\u044c\u0442\u0435 \u0442\u0435\u043a\u0441\u0442 \u043d\u0438\u0436\u0435 (\u0432\u043c\u0435\u0441\u0442\u0435 \u0441 \u0444\u0438\u0433\u0443\u0440\u043d\u044b\u043c\u0438 \u0441\u043a\u043e\u0431\u043a\u0430\u043c\u0438)"),r.a.createElement(K.a,{border:3,borderRadius:16,borderColor:"primary.main",style:{borderStyle:"dashed",position:"relative"}},r.a.createElement(K.a,{position:"absolute",top:0,right:0},r.a.createElement(V.a,{title:"\u0421\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u0443\u0444\u0435\u0440 \u043e\u0431\u043c\u0435\u043d\u0430"},r.a.createElement(T.a,{"aria-label":"copy",size:"small",onClick:function(){navigator.clipboard.writeText(JSON.stringify(ge))}},r.a.createElement(Q.a,null)))),r.a.createElement(H.a,{variant:"body1",fullwidth:!0,style:{textAlign:"left",overflowWrap:"anywhere",padding:10}},JSON.stringify(ge)))):null,r.a.createElement("div",{style:{paddingTop:20,paddingBottom:20,textAlign:"center"}},r.a.createElement(G.a,{variant:"outlined",style:{borderWidth:2,borderColor:"#003366",color:"#003366",margin:10},disabled:!!D,onClick:ke},"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c"),ee?r.a.createElement(G.a,{variant:"outlined",style:{borderWidth:2,borderColor:"red",color:"red",margin:10},disabled:!!D,onClick:function(){return Y(!0)}},"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0435 \u0444\u0430\u0439\u043b\u043e\u0432"):null)),r.a.createElement(B.a,{anchorOrigin:{vertical:"bottom",horizontal:"left"},open:L,autoHideDuration:6e3,onClose:Ae,message:"\u0412\u0430\u0448 \u043e\u0442\u0432\u0435\u0442 \u043f\u0440\u0438\u043d\u044f\u0442",action:r.a.createElement(r.a.Fragment,null,r.a.createElement(T.a,{size:"small","aria-label":"close",color:"inherit",onClick:Ae},r.a.createElement(P.a,{fontSize:"small"})))}))})),Z=n(205),$=n(97),ee=n.n($),te=n(204),ne=n(203),ae=function(e){return r.a.createElement(K.a,{display:"flex",alignItems:"center"},r.a.createElement(K.a,{width:"100%",mr:1},r.a.createElement(ne.a,Object.assign({variant:"determinate"},e))),r.a.createElement(K.a,{minWidth:35},r.a.createElement(H.a,{variant:"body2",color:"textSecondary"},"".concat(Math.round(e.value),"%"))))},re=Object(a.forwardRef)((function(e,t){var n=e.title,i=e.index,o=e.subindex,l=Object(a.useContext)(O).currentUser,d=Object(a.useState)(null),f=Object(u.a)(d,2),m=f[0],p=f[1],b=Object(a.useState)(0),g=Object(u.a)(b,2),h=g[0],v=g[1],j=Object(a.useState)(null),w=Object(u.a)(j,2),y=w[0],x=w[1],S=Object(a.useState)(!1),k=Object(u.a)(S,2),_=k[0],C=k[1],D=null;Object(a.useImperativeHandle)(t,(function(){return{startUpload:function(){m?(m.forEach((function(e){console.log(e),D.startUpload(e)})),y&&e.uploadFilesData(null,null,i,o,y)):y&&(e.uploadFilesData(null,null,i,o,y),v(100))}}}));var R=function(){var t=Object(s.a)(c.a.mark((function t(n){var a;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,E.storage().ref(l.uid).child(n).getDownloadURL();case 2:a=t.sent,v(100),C(!1),e.uploadFilesData(n,a,i,o,null);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return r.a.createElement("div",{key:o?i+"."+o:i,style:{padding:20}},r.a.createElement(H.a,{variant:"body1",style:{fontSize:16,fontWeight:"bolder"}},n),r.a.createElement(te.a,{container:!0,display:"flex",style:{paddingTop:10,paddingLeft:20}},r.a.createElement(H.a,{variant:"body1",style:{paddingRight:20}},"\u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0444\u0430\u0439\u043b\u044b"),r.a.createElement(ee.a,{storageRef:E.storage().ref().child(l.uid),onUploadStart:function(){v(0),C(!0)},onUploadError:function(e){C(!1),alert(e),console.error(e)},onUploadSuccess:R,onProgress:function(e){v(e)},multiple:!0,onChange:function(e){var t=e.target.files,n=[];Array.from(t).forEach((function(e){return n.push(e)})),p(n)},ref:function(e){D=e}})),r.a.createElement(te.a,{container:!0,style:{paddingTop:10,paddingLeft:20}},r.a.createElement(H.a,{variant:"body1",style:{paddingRight:20}},"\u0438\u043b\u0438 \u0432\u0432\u0435\u0434\u0438\u0442\u0435 URL"),r.a.createElement("input",{type:"text",size:"40",onChange:function(e){x(e.target.value)}})),r.a.createElement(te.a,{style:{paddingTop:20}},_?r.a.createElement(Z.a,null):null,r.a.createElement(ae,{value:h})))})),ie=function(e){var t=Object(a.useState)([]),n=Object(u.a)(t,2),i=n[0],o=n[1],l=Object(a.useState)({}),d=Object(u.a)(l,2),f=(d[0],d[1]),p=Object(a.useState)(!1),b=Object(u.a)(p,2),g=b[0],h=b[1],v=Object(a.useState)(!1),j=Object(u.a)(v,2),w=j[0],y=j[1],x=Object(a.useState)([]),S=Object(u.a)(x,2),k=S[0],_=S[1],C=Object(a.useState)(null),D=Object(u.a)(C,2),R=D[0],U=D[1],A=Object(a.useState)(null),F=Object(u.a)(A,2),L=F[0],I=F[1],q=Object(a.useState)(null),z=Object(u.a)(q,2),M=z[0],N=z[1],W=Object(a.useState)(null),K=Object(u.a)(W,2),J=K[0],Q=K[1],V=Object(a.useContext)(O).currentUser,X=Object(m.g)().id,Y=[];Object(a.useEffect)((function(){Z()}),[]),Object(a.useEffect)((function(){V&&E.firestore().collection("users").doc(V.uid).get().then((function(e){return N(e.data())}))}),[]);var Z=function(){var e=E.firestore().collection("responses").doc(V.uid).collection("answers");X?e.doc(X).get().then((function(e){f(e.data().answers),U(e.id),"form_mobile"===e.data().identifier&&(console.log("UIK NUMBER",e.data().answers[0]),e.data().answers[0]?Q(e.data().answers[0]):Q("")),$(e.data()),I(e.data())})):e.orderBy("date","desc").limit(1).get().then((function(e){e.forEach((function(e){console.log(e.id," => ",e.data()),e&&e.exists&&(f(e.data().answers),U(e.id),"form_mobile"===e.data().identifier&&(console.log("UIK NUMBER",e.data().answers[0]),e.data().answers[0]?Q(e.data().answers[0]):Q("")),$(e.data()),I(e.data()))}))}))},$=function(e){fetch(e.form_url).then((function(e){return e.json()})).then((function(t){o(t),t.period&&ee(t),ne(t,e.answers),_(Y)}))},ee=function(e){var t=new Date,n=new Date(e.period.start),a=new Date(e.period.finish);n>t&&e.period.before.nofill||n<t&&t<a&&e.period.in.nofill||t>a&&e.period.after.nofill?h(!0):h(!1),console.log("LOCKED ",g)},ne=function(e,t){e.questions.forEach((function(e,n){e.attachMaterials&&("multiradio"===e.type?t[n]&&Object.keys(t[n]).forEach((function(a){t[n][a].toString()===e.subquestion[a].on&&Y.push({title:e.subquestion[a].q,index:n,subindex:a})})):Y.push({title:e.title,index:n}))}))},ae=function(e,t){"clickaway"!==t&&y(!1)},ie=function(){var e=Object(s.a)(c.a.mark((function e(t,n,a,r,o){var l,s,u,d,f;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:l=M.polling_station,"form_mobile"===i.identifier&&(l=J),s="",M.district&&(s=M.district),u=E.firestore().collection("responses"),d=u.doc(V.uid),f=d.collection("files"),console.log("\u0424\u0430\u0439\u043b \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d"),t&&n&&f.add({public_url:n,filename:t,answer_number:a,answer_id:R,answer_subnumber:r,form_name:i.main_title,date:new Date,identifier:i.identifier,user_id:V.uid,user_email:V.email,form_url:L.form_url,polling_station:l,district:s}),o&&f.add({public_url:o,answer_number:a,answer_id:R,answer_subnumber:r,form_name:i.main_title,date:new Date,identifier:i.identifier,user_id:V.uid,user_email:V.email,form_url:L.form_url,polling_station:l,district:s});case 10:case"end":return e.stop()}}),e)})));return function(t,n,a,r,i){return e.apply(this,arguments)}}(),oe=Object(a.useRef)([]);Object(a.useEffect)((function(){oe.current=oe.current.slice(0,k.length)}),[k]);return r.a.createElement("div",null,r.a.createElement("br",null),r.a.createElement(H.a,{variant:"h4",align:"center"},i.main_title),k.map((function(e,t){var n=e.title,a=e.index.toString(),i=e.subindex?e.subindex.toString():null;return r.a.createElement(re,{ref:function(e){return oe.current[t]=e},key:t,title:n,index:a,subindex:i,uploadFilesData:ie})})),Array.isArray(k)&&k.length?r.a.createElement("div",null,r.a.createElement(te.a,{container:!0,justify:"center",style:{paddingTop:20,paddingBottom:20}},r.a.createElement(G.a,{variant:"contained",onClick:function(){oe.current.forEach((function(e){return e.startUpload()}))}},"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c"))):r.a.createElement(H.a,{variant:"h6",align:"center"},"\u041a \u044d\u0442\u043e\u0439 \u0444\u043e\u0440\u043c\u0435 \u043d\u0435\u043b\u044c\u0437\u044f \u043f\u0440\u0438\u043b\u043e\u0436\u0438\u0442\u044c \u0444\u0430\u0439\u043b"),r.a.createElement(B.a,{anchorOrigin:{vertical:"bottom",horizontal:"left"},open:w,autoHideDuration:5e3,onClose:ae,message:"\u0412\u0430\u0448\u0438 \u0444\u0430\u0439\u043b\u044b \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u044b",action:r.a.createElement(r.a.Fragment,null,r.a.createElement(T.a,{size:"small","aria-label":"close",color:"inherit",onClick:ae},r.a.createElement(P.a,{fontSize:"small"})))}))},oe=function(){var e=Object(a.useState)(null),t=Object(u.a)(e,2),n=t[0],i=t[1],o=Object(a.useContext)(O).currentUser;return Object(a.useEffect)((function(){var e=E.firestore().collection("responses").doc(o.uid);console.log(o.uid),e.collection("answers").orderBy("date","desc").get().then((function(e){var t=[];e.forEach((function(e){e&&e.exists&&t.push({id:e.id,data:e.data()})})),i(t)}))}),[o]),console.log(n),r.a.createElement(r.a.Fragment,null,r.a.createElement(H.a,{variant:"h4",align:"center"},"\u0418\u0441\u0442\u043e\u0440\u0438\u044f"),n?n.map((function(e,t){var n=new Date(1e3*Object(v.a)({},e.data.date).seconds),a=[n.getDate().toString().length<2?"0"+n.getDate():n.getDate(),(n.getMonth()+1).toString().length<2?"0"+(n.getMonth()+1):n.getMonth()+1,n.getFullYear()].join("/")+" "+[n.getHours().toString().length<2?"0"+n.getHours():n.getHours(),n.getMinutes().toString().length<2?"0"+n.getMinutes():n.getMinutes(),n.getSeconds().toString().length<2?"0"+n.getSeconds():n.getSeconds()].join(":").toString();return r.a.createElement(te.a,{key:t,container:!0,alignItems:"center"},r.a.createElement(f.b,{to:"/files/"+e.id,style:{flexGrow:1,paddingRight:20,textDecoration:"none"}},e.data.form_name),r.a.createElement("p",null,a))})):r.a.createElement(H.a,{variant:"h6",align:"center",style:{marginTop:20}},"\u041f\u0443\u0441\u0442\u043e"))},le=n(64),ce=function(e){var t=Object(a.useState)([]),n=Object(u.a)(t,2),i=(n[0],n[1]),o=Object(a.useState)({}),l=Object(u.a)(o,2),d=(l[0],l[1],Object(a.useState)(null)),f=Object(u.a)(d,2),p=f[0],b=f[1],g=Object(a.useState)(null),h=Object(u.a)(g,2),v=h[0],j=h[1],w=Object(a.useContext)(O).currentUser,y=Object(m.h)(),x=y.path;y.url;return Object(a.useEffect)((function(){E.firestore().collection("users").doc(w.uid).get().then((function(e){return e.data().role?j(e.data().role):j("independent")}));var e=le.parse(window.location.search);e.url?fetch(e.url).then((function(e){return e.json()})).then((function(e){i(e);var t=e.map(function(){var e=Object(s.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t.url).then((function(e){return e.json()})).then((function(e){return e}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());Promise.all(t).then((function(e){b(e)}))})):console.log("ERROR: no url detected")}),[]),r.a.createElement(r.a.Fragment,null,r.a.createElement("br",null),p&&v?r.a.createElement("div",null,r.a.createElement("br",null),r.a.createElement(m.d,null,r.a.createElement(m.b,{exact:!0,path:x},r.a.createElement(oe,null)))):null)},se=Object(m.i)((function(e){e.history;var t=Object(a.useContext)(O).currentUser;Object(m.h)().url;return t?r.a.createElement(m.a,{to:"/form"}):r.a.createElement("div",null,r.a.createElement(H.a,{align:"center",variant:"h4"},"\u0412\u043e\u0439\u0442\u0438 \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u0430\u043a\u043a\u0430\u0443\u043d\u0442\u0430 Google"),r.a.createElement(te.a,{container:!0,justify:"center",style:{marginTop:20}},r.a.createElement(G.a,{variant:"contained",onClick:h},"Sign-in with Google")))})),ue=Object(m.i)((function(e){var t=e.history;Object(a.useCallback)(function(){var e=Object(s.a)(c.a.mark((function e(n){var a,r,i;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),a=n.target.elements,r=a.email,i=a.password,e.prev=2,e.next=5,E.auth().createUserWithEmailAndPassword(r.value,i.value);case 5:t.push("/ElectionsMonitoringForms"),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),alert(e.t0);case 11:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(t){return e.apply(this,arguments)}}(),[t]);return r.a.createElement("div",null,r.a.createElement("h1",null,"Sign up"),r.a.createElement("button",{onClick:h},"Sign-in with Google"))})),de=n(101),fe=function(e){var t=e.component,n=Object(de.a)(e,["component"]),i=Object(a.useContext)(O).currentUser;return r.a.createElement(m.b,Object.assign({},n,{render:function(e){return i?r.a.createElement(t,e):r.a.createElement(m.a,{to:"/login"})}}))},me=n(98),pe=n(99),be=n(102),ge=n(100),he=n(64),Ee=function(e){Object(be.a)(n,e);var t=Object(ge.a)(n);function n(){var e;Object(me.a)(this,n);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).state={questions:[],main_title:"",answers:{},id:"",showAnswers:!1,period:null,locked:!1,showFileUpload:!1,fileInputs:[],snackbar:!1,uploadSuccsess:!1},e.downloadData=function(t){var n=he.parse(window.location.search,{decode:!1});t?(console.log(n),fetch(t).then((function(e){return e.json()})).then((function(t){console.log(t),e.setState({questions:t.questions,main_title:t.main_title,period:t.period}),t.period&&e.timeManager(t),e.renderFiles(),e.setState({fileInputs:e.fileInputs}),console.log(e.fileInputs)}))):console.log("ERROR: no url detected")},e.loadAttachmentQuestions=function(){E.firestore().collection("responses").doc(e.context.currentUser.uid).collection("answers").orderBy("date","desc").limit(1).get().then((function(t){t.forEach((function(t){console.log(t.id," => ",t.data()),t&&t.exists&&(e.setState({answers:t.data().answers}),e.setState({id:t.id}),e.downloadData(t.data().form_url))}))})),e.setState({showFileUpload:!0})},e.timeManager=function(t){var n=new Date,a=new Date(t.period.start),r=new Date(t.period.finish);a>n&&t.period.before.nofill||a<n&&n<r&&t.period.in.nofill||n>r&&t.period.after.nofill?e.setState({locked:!0}):e.setState({locked:!1}),console.log("LOCKED ",e.state.locked)},e.fileInputs=[],e.renderFiles=function(){e.state.questions.forEach((function(t,n){t.attachMaterials&&("multiradio"===t.type?e.state.answers[n]&&Object.keys(e.state.answers[n]).forEach((function(a){console.log(a),e.state.answers[n][a]===t.subquestion[a].on&&e.fileInputs.push({title:t.subquestion[a].q,index:n,subindex:a})})):e.fileInputs.push({title:t.title,index:n}))}))},e.handleCloseSnackbar=function(t,n){"clickaway"!==n&&e.setState({snackbar:!1})},e.files={},e.filesData={},e.progress=0,e.handleFileChange=function(t,n,a,r){e.files[r]={file:t.target.files,index:n,subindex:a}},e.handleURLChange=function(t,n,a,r){e.filesData[r]={url:t.target.value,index:n,subindex:a}},e.uploadFiles=function(){var t=E.storage().ref().child(e.context.currentUser.uid);e.progress=0;var n=0;Object.values(e.files).forEach((function(e){Array.from(e.file).forEach((function(e){return n+=1}))})),Object.values(e.filesData).forEach((function(e){return n+=1})),console.log("COUNT",n),Object.values(e.files).concat(Object.values(e.filesData)).forEach((function(a,r){if(a.file&&Array.from(a.file).forEach((function(r){t.child(r.name).put(r).then((function(e){return e.ref.getDownloadURL()})).then((function(t){var r=E.firestore().collection("responses").doc(e.context.currentUser.uid).collection("files");e.setState({snackbar:!0}),console.log("\u0424\u0430\u0439\u043b \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d"),r.add({filepath:t,answer_number:a.index,answer_id:e.state.id,answer_subnumber:a.subindex,form_name:e.state.main_title,date:new Date}).then((function(){return e.progress+=1/n*100})).catch((function(e){return alert(e)}))})).catch(console.error)})),a.url){var i=E.firestore().collection("responses").doc(e.context.currentUser.uid).collection("files");e.setState({snackbar:!0}),i.add({filepath:a.url,answer_number:a.index,answer_id:e.state.id,answer_subnumber:a.subindex}).then((function(){return e.progress+=1/n*100})).catch((function(e){return alert(e)}))}}))},e.LinearProgressWithLabel=function(e){return r.a.createElement(K.a,{display:"flex",alignItems:"center"},r.a.createElement(K.a,{width:"100%",mr:1},r.a.createElement(ne.a,Object.assign({variant:"determinate"},e))),r.a.createElement(K.a,{minWidth:35},r.a.createElement(H.a,{variant:"body2",color:"textSecondary"},"".concat(Math.round(e.value),"%"))))},e}return Object(pe.a)(n,[{key:"componentDidMount",value:function(){this.loadAttachmentQuestions()}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(H.a,{variant:"h4",align:"center"},this.state.main_title),this.fileInputs.map((function(t,n){var a=t.title,i=t.index.toString(),o=t.subindex?t.subindex.toString():null;return r.a.createElement("div",{key:o?i+"."+o:i,style:{padding:20}},r.a.createElement(H.a,{variant:"body1",style:{fontSize:16,fontWeight:"bolder"}},a),r.a.createElement(te.a,{container:!0,display:"flex",style:{paddingTop:10,paddingLeft:20}},r.a.createElement(H.a,{variant:"body1",style:{paddingRight:20}},"\u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0444\u0430\u0439\u043b\u044b"),r.a.createElement("input",{disabled:e.state.locked,type:"file",name:"filefield",multiple:"multiple",onChange:function(t){return e.handleFileChange(t,i,o,n)}})),r.a.createElement(te.a,{container:!0,style:{paddingTop:10,paddingLeft:20}},r.a.createElement(H.a,{variant:"body1",style:{paddingRight:20}},"\u0438\u043b\u0438 \u0432\u0432\u0435\u0434\u0438\u0442\u0435 URL"),r.a.createElement("input",{type:"text",size:"40",onChange:function(t){return e.handleURLChange(t,i,o,n)}})))})),r.a.createElement(te.a,{container:!0,justify:"center",style:{paddingTop:20,paddingBottom:20}},r.a.createElement(G.a,{variant:"contained",onClick:this.uploadFiles},"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c")),r.a.createElement(this.LinearProgressWithLabel,{value:this.progress}),r.a.createElement(B.a,{anchorOrigin:{vertical:"bottom",horizontal:"left"},open:this.state.snackbar,autoHideDuration:5e3,onClose:this.handleCloseSnackbar,message:"\u0412\u0430\u0448\u0438 \u0444\u0430\u0439\u043b\u044b \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u044b",action:r.a.createElement(r.a.Fragment,null,r.a.createElement(T.a,{size:"small","aria-label":"close",color:"inherit",onClick:this.handleCloseSnackbar},r.a.createElement(P.a,{fontSize:"small"})))}))}}]),n}(a.Component);Ee.contextType=O;var ve=n(206),Oe=n(207),je=n(64),we=Object(w.a)((function(e){var t;return{app:(t={padding:"10px"},Object(d.a)(t,e.breakpoints.down("sm"),{width:"100%"}),Object(d.a)(t,e.breakpoints.up("sm"),{width:"70%"}),Object(d.a)(t,e.breakpoints.up("md"),{width:"55%"}),Object(d.a)(t,"title",{fontColor:"blue"}),t),appbar:{background:"transparent",boxShadow:"none"},title:{flexGrow:1},menuButton:{marginRight:e.spacing(2)},avatar:{width:e.spacing(4),height:e.spacing(4)},toolbar:{padding:0}}})),ye=function(){var e=Object(a.useState)(null),t=Object(u.a)(e,2),n=t[0],i=t[1],o=Object(a.useState)([]),l=Object(u.a)(o,2),d=l[0],p=l[1],b=Object(a.useState)({}),g=Object(u.a)(b,2),h=(g[0],g[1],Object(a.useState)(null)),v=Object(u.a)(h,2),j=v[0],w=v[1],y=Object(a.useState)(null),x=Object(u.a)(y,2),S=x[0],k=x[1],_=Object(a.useState)(!0),C=Object(u.a)(_,2),D=C[0],R=C[1],U=Object(a.useContext)(O).currentUser,A=we();Object(a.useEffect)((function(){U&&E.firestore().collection("users").doc(U.uid).get().then((function(e){return i(e.data())}))}),[]),Object(a.useEffect)((function(){U&&function(){var e=Object(s.a)(c.a.mark((function e(){var t,n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=E.firestore().collection("users"),t.doc(U.uid).get().then((function(e){return e.data().role?k(e.data().role):k("independent")})),(n=je.parse(window.location.search)).url?fetch(n.url).then((function(e){return e.json()})).then((function(e){p(e);var t=e.map(function(){var e=Object(s.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t.url).then((function(e){return e.json()})).then((function(e){return e}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());Promise.all(t).then((function(e){w(e)}))})):console.log("ERROR: no url detected");case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()()}),[]);return r.a.createElement("div",null,r.a.createElement(ve.a,{position:"static",className:A.appbar},r.a.createElement(Oe.a,null,r.a.createElement(te.a,{style:{flexGrow:1}},r.a.createElement("img",{src:"https://kloop.kg/wp-content/uploads/2017/01/kloop_transparent_site.png",alt:"Kloop.kg - \u041d\u043e\u0432\u043e\u0441\u0442\u0438 \u041a\u044b\u0440\u0433\u044b\u0437\u0441\u0442\u0430\u043d\u0430",style:{width:150,height:"auto"}})),U?r.a.createElement(G.a,{style:{borderColor:"#003366",color:"#003366",marginLeft:10,fontSize:12},size:"small",variant:"outlined",onClick:function(){return E.auth().signOut()}},"\u0432\u044b\u0445\u043e\u0434"):null)),r.a.createElement(te.a,{container:!0,justify:"center"},r.a.createElement("div",{className:A.app},U&&n?r.a.createElement("div",null,r.a.createElement(H.a,{variant:"body1",style:{color:"#003366",paddingLeft:5,paddingRight:5}},"\u041f\u043e\u0447\u0442\u0430: ",U.email?U.email:"\u043e\u0442\u0441\u0443\u0442\u0441\u0432\u0443\u0435\u0442"),r.a.createElement(H.a,{variant:"body1",style:{color:"#003366",paddingLeft:5,paddingRight:5}},"\u0420\u0430\u0439\u043e\u043d: ",n.district?n.district:"\u043e\u0442\u0441\u0443\u0442\u0441\u0432\u0443\u0435\u0442"),r.a.createElement(H.a,{variant:"body1",style:{color:"#003366",paddingLeft:5,paddingRight:5}},"\u2116 \u0423\u0418\u041a: ",n.polling_station?n.polling_station:"\u043e\u0442\u0441\u0443\u0442\u0441\u0432\u0443\u0435\u0442"),r.a.createElement(H.a,{variant:"body1",style:{color:"#003366",paddingLeft:5,paddingRight:5}},"\u0420\u043e\u043b\u044c: ",n.role?n.role:"\u043e\u0442\u0441\u0443\u0442\u0441\u0432\u0443\u0435\u0442")):null,r.a.createElement(f.a,null,r.a.createElement("div",null,U?r.a.createElement("nav",null,r.a.createElement("ul",null,r.a.createElement("li",{style:{padding:5}},r.a.createElement(f.b,{style:{textDecoration:"none"},to:"/form",onClick:function(){return R(!0)}},"\u041d\u0430 \u0433\u043b\u0430\u0432\u043d\u0443\u044e / \u0411\u0430\u0448\u043a\u044b \u0431\u0435\u0442\u043a\u0435")),r.a.createElement("li",{style:{padding:5}},r.a.createElement(f.b,{style:{textDecoration:"none"},to:"/files",onClick:function(){return R(!1)}},"\u0424\u043e\u0440\u043c\u0430 \u0434\u043b\u044f \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0438 \u0444\u0430\u0439\u043b\u043e\u0432 / \u0424\u0430\u0439\u043b \u0436\u04e9\u043d\u04e9\u0442\u04af\u04af \u04af\u0447\u04af\u043d \u0444\u043e\u0440\u043c\u0430")),D&&j&&S?r.a.createElement("div",null,d.map((function(e,t){return function(e){var t=new Date,n=new Date(e.period.start),a=new Date(e.period.finish);return!!(n>t&&e.period.before.nofill)||(!!(n<t&&t<a&&e.period.in.nofill)||!!(t>a&&e.period.after.nofill))}(j[t])?null:S===e.role||"all"===e.role||"moderator"===S?r.a.createElement("li",{key:t,style:{padding:5}},r.a.createElement(f.b,{style:{textDecoration:"none"},to:"/form"+e.path,onClick:function(){return R(!1)}},e.label)):null}))):null)):r.a.createElement(m.a,{to:"/login"}),r.a.createElement(m.d,null,r.a.createElement(fe,{exact:!0,path:"/form",component:ce}),r.a.createElement(m.b,{path:"/login",component:se}),r.a.createElement(m.b,{path:"/signup",component:ue}),r.a.createElement(m.b,{path:"/form/:form"},r.a.createElement(Y,{user:n})),r.a.createElement(m.b,{exact:!0,path:"/files",component:Object(m.i)(ie)}),r.a.createElement(m.b,{path:"/files/:id",component:Object(m.i)(ie)})))))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(j,null,r.a.createElement(ye,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},55:function(e,t,n){}},[[121,1,2]]]);
//# sourceMappingURL=main.bc3ae9d2.chunk.js.map