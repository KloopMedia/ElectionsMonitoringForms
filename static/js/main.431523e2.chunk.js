(this["webpackJsonpkloop-forms"]=this["webpackJsonpkloop-forms"]||[]).push([[0],{124:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(11),l=n.n(o),s=(n(96),n(38)),i=n(39),c=n(44),u=n(43),d=n(46),p=(n(58),n(27)),m=n(9),f=n(47),h=n.n(f),w=n(61),b=n(12),E=n(54),g=n.n(E);g.a.initializeApp({apiKey:"AIzaSyCCAhvWFvwuxDUXZ4aV-FhB_Dj-lp_frCw",authDomain:"electionsmonitor-5d008.firebaseapp.com",databaseURL:"https://electionsmonitor-5d008.firebaseio.com",projectId:"electionsmonitor-5d008",storageBucket:"electionsmonitor-5d008.appspot.com",messagingSenderId:"145410178875",appId:"1:145410178875:web:6cf434df68d3c65062811e",measurementId:"G-EXC8T9QXES"});var v=new g.a.auth.GoogleAuthProvider,O=function(){g.a.auth().signInWithPopup(v)},j=g.a,k=n(36),y=r.a.createContext(),x=function(e){var t=e.children,n=Object(a.useState)(null),o=Object(b.a)(n,2),l=o[0],s=o[1],i=Object(a.useState)(!0),c=Object(b.a)(i,2),u=c[0],d=c[1];return Object(a.useEffect)((function(){j.auth().onAuthStateChanged((function(e){s(e),d(!1),j.firestore().collection("users").doc(e.uid).set({name:e.displayName,role:"independent"})}))}),[]),u?r.a.createElement(r.a.Fragment,null,"Loading..."):r.a.createElement(y.Provider,{value:{currentUser:l}},t)},A=n(156),S=n(168),F=Object(A.a)((function(e){return{root:{"& > *":{width:"40ch"}}}}));var C=function(e){var t=F(),n=r.a.useState(""),o=Object(b.a)(n,2),l=o[0],s=o[1],i=e.index,c=e.response;return Object(a.useEffect)((function(){c&&s(c)}),[c]),r.a.createElement("div",null,r.a.createElement("form",{noValidate:!0,autoComplete:"off"},r.a.createElement("h4",null,e.title),r.a.createElement(S.a,{className:t.root,id:"inputBox"+i,label:"\u041c\u043e\u0439 \u043e\u0442\u0432\u0435\u0442",value:l,onChange:function(t){s(t.target.value),e.returnAnswer(t.target.value,i,t.target.value)},disabled:!!e.locked})))},D=n(169),q=n(170),M=n(162),_=n(164),I=Object(A.a)((function(e){return{formControl:{minWidth:120}}}));function U(e){var t=I(),n=r.a.useState(""),o=Object(b.a)(n,2),l=o[0],s=o[1],i=r.a.useState(!1),c=Object(b.a)(i,2),u=c[0],d=c[1],p=e.index,m=e.response;Object(a.useEffect)((function(){m&&s(m)}),[m]);return r.a.createElement("div",null,r.a.createElement("h4",null,e.title),r.a.createElement(M.a,{className:t.formControl,disabled:!!e.locked},r.a.createElement(D.a,{id:"controlled-open-select-label"},"\u0412\u044b\u0431\u0440\u0430\u0442\u044c"),r.a.createElement(_.a,{labelId:"controlled-open-select-label",id:"select"+p,open:u,onClose:function(e){d(!1)},onOpen:function(e){d(!0)},value:l,onChange:function(t){s(t.target.value);var n=e.answers.indexOf(t.target.value);e.returnAnswer(t.target.value,p,n)}},r.a.createElement(q.a,{value:""},r.a.createElement("em",null,"None")),e.answers.map((function(e,t){return r.a.createElement(q.a,{key:t,value:e},e)})))))}var N=n(165),R=n(167),B=n(171);function L(e){var t=r.a.useState(""),n=Object(b.a)(t,2),o=n[0],l=n[1],s=e.index,i=e.response;Object(a.useEffect)((function(){i&&l(i)}),[i]);return r.a.createElement("div",null,r.a.createElement("h4",null,e.title),r.a.createElement(M.a,{const:"fieldset"},r.a.createElement(R.a,{"aria-label":e.title,name:e.title,value:o,onChange:function(t){l(t.target.value);var n=e.answers.indexOf(t.target.value);e.returnAnswer(t.target.value,s,n)}},e.answers.map((function(t,n){return r.a.createElement(B.a,{key:n,value:t,control:r.a.createElement(N.a,null),label:t,disabled:!!e.locked})})))))}var P=Object(A.a)((function(e){return{container:{display:"flex",flexWrap:"wrap"},textField:{marginLeft:e.spacing(1),marginRight:e.spacing(1),width:"auto"}}}));function J(e){var t=P(),n=r.a.useState(""),o=Object(b.a)(n,2),l=o[0],s=o[1],i=e.index,c=e.response;Object(a.useEffect)((function(){c&&s(c)}),[i,c]);return r.a.createElement("div",null,r.a.createElement("h4",null,e.title),r.a.createElement("form",{className:t.container,noValidate:!0},r.a.createElement(S.a,{id:"time"+i,label:"\u0412\u0440\u0435\u043c\u044f",type:"time",value:l,onChange:function(t){s(t.target.value),e.returnAnswer(t.target.value,i,t.target.value)},className:t.textField,InputLabelProps:{shrink:!0},InputProps:{disableUnderline:!0},disabled:!!e.locked})))}var W=Object(A.a)({root:{background:"linear-gradient(45deg, #FE6B8B 30%, #FF8E53 90%)",border:0,borderRadius:3,boxShadow:"0 3px 5px 2px rgba(255, 105, 135, .3)",color:"white",height:48,padding:"0 30px"}});function T(e){W();var t=Object(a.useState)({}),n=Object(b.a)(t,2),o=n[0],l=n[1],s=Object(a.useState)({}),i=Object(b.a)(s,2),c=i[0],u=i[1],d={},p={},m=e.index,f=e.response;Object(a.useEffect)((function(){console.log(e.question),f&&l(f)}),[f]);var h=function(t){return function(n){(d=Object(k.a)({},o))[t]=n.target.value,l(d),p=Object(k.a)({},c);var a=e.answers.indexOf(n.target.value);p[t]=a,u(p),e.returnAnswer(d,m,p)}};return r.a.createElement("div",{className:"radioHorizontal"},r.a.createElement("h4",null,e.title),r.a.createElement("button",{onClick:function(){l({}),e.returnAnswer({},m)}},"clear"),r.a.createElement("div",{className:"question_item"},e.subquestion.map((function(t,n){return r.a.createElement("div",{className:"question_item_",key:n},r.a.createElement("p",null,t.q),r.a.createElement(M.a,{component:"fieldset"},r.a.createElement(R.a,{"aria-label":"position",name:"position",row:!0,value:o[n]?o[n]:"",onClick:h(n)},e.answers.map((function(t,n){return r.a.createElement(B.a,{key:n,value:t,control:r.a.createElement(N.a,{color:"primary"}),label:t,labelPlacement:"top",disabled:!!e.locked,style:{paddingLeft:5,paddingRight:5}})})))))}))))}var G=n(66),z=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(s.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).state={questions:[],main_title:"",gateway:"",answers:{},shortAnswers:{},showAnswers:!1,response:{},period:null,locked:!1,files:[],showFileUpload:!1},e.downloadData=function(){var t=G.parse(window.location.search,{decode:!1});console.log(e.props.data),e.setState({questions:e.props.data.questions,main_title:e.props.data.main_title,period:e.props.data.period}),t.response&&e.initResponse(e.props.data,t),e.props.data.period&&e.timeManager(e.props.data)},e.uploadData=function(){try{j.firestore().collection("responses").doc(e.context.currentUser.uid).collection("answers").add({answers:e.state.answers,form_name:e.state.main_title,form_url:e.props.url,date:new Date}).catch((function(e){return alert(e)})),console.log("data uploaded"),e.setState({showAnswers:!0}),e.setState({showFileUpload:!0})}catch(t){alert(t),e.setState({showAnswers:!0})}},e.timeManager=function(t){var n=new Date,a=new Date(t.period.start),r=new Date(t.period.finish);a>n&&t.period.before.nofill||a<n&&n<r&&t.period.in.nofill||n>r&&t.period.after.nofill?e.setState({locked:!0}):e.setState({locked:!1}),console.log("LOCKED ",e.state.locked)},e.initResponse=function(t,n){var a=decodeURI(n.response),r=JSON.parse(a);e.setState({response:r});for(var o=0,l=Object.entries(r);o<l.length;o++){var s=Object(b.a)(l[o],2),i=s[0],c=s[1],u=null;if(i===Object.keys(r)[0]&&e.returnAnswer(c,i),"input"===t.questions[i].type)e.returnAnswer(c,i);else if("time"===t.questions[i].type)e.returnAnswer(c,i,c);else if("multiradio"===t.questions[i].type)for(var d=0,p=Object.entries(c);d<p.length;d++){var m=Object(b.a)(p[d],2),f=m[0],h=m[1],w=t.questions[i].answer.indexOf(h),E=Object(k.a)({},e.state.shortAnswers[i]);E[f]=w,e.returnAnswer(c,i,E)}else u=t.questions[i].answer.indexOf(c),e.returnAnswer(c,i,u)}},e.returnAnswer=function(t,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=Object(k.a)({},e.state.answers);r[n]=t,e.setState({answers:r});var o=Object(k.a)({},e.state.shortAnswers);o[n]=a,e.setState({shortAnswers:o})},e}return Object(i.a)(n,[{key:"componentDidMount",value:function(){this.downloadData()}},{key:"render",value:function(){var e=this,t=this.state.questions.map((function(t,n){var a=e.state.response;return"input"===t.type?r.a.createElement(C,{key:n,index:n,title:t.title,response:a[n],returnAnswer:e.returnAnswer,locked:e.state.locked}):"select"===t.type?r.a.createElement(U,{key:n,index:n,title:t.title,response:a[n],answers:t.answer,returnAnswer:e.returnAnswer,locked:e.state.locked}):"radio"===t.type?r.a.createElement(L,{key:n,index:n,title:t.title,response:a[n],answers:t.answer,returnAnswer:e.returnAnswer,locked:e.state.locked}):"time"===t.type?r.a.createElement(J,{key:n,index:n,title:t.title,response:a[n],returnAnswer:e.returnAnswer,locked:e.state.locked}):"multiradio"===t.type?r.a.createElement(T,{key:n,index:n,title:t.title,response:a[n],subquestion:t.subquestion,answers:t.answer,returnAnswer:e.returnAnswer,locked:e.state.locked}):null}));return r.a.createElement("div",null,r.a.createElement("h1",{className:"text-align-center"},this.state.main_title),this.state.period?r.a.createElement("div",null,r.a.createElement("p",null,"Start: ",this.state.period.start),r.a.createElement("p",null,"Finish: ",this.state.period.finish)):null,this.state.showFileUpload?r.a.createElement(m.a,{to:"/ElectionsMonitoringForms/files"}):null,r.a.createElement("div",null,t,r.a.createElement("div",{style:{paddingTop:20,paddingBottom:20,textAlign:"center"}},r.a.createElement("button",{disabled:!!this.state.locked,onClick:this.uploadData},"Send data"))),this.state.showAnswers?r.a.createElement("p",{style:{textAlign:"left"}},"Full answers: ",JSON.stringify(this.state.answers)):null,this.state.showAnswers?r.a.createElement("p",{style:{textAlign:"left"}},"Short answers: ",JSON.stringify(this.state.shortAnswers)):null)}}]),n}(a.Component);z.contextType=y;var K=Object(m.g)(z),Q=n(66),V=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(s.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).state={questions:[],main_title:"",answers:{},id:"",showAnswers:!1,period:null,locked:!1,showFileUpload:!1,fileInputs:[]},e.downloadData=function(t){var n=Q.parse(window.location.search,{decode:!1});t?(console.log(n),fetch(t).then((function(e){return e.json()})).then((function(t){console.log(t),e.setState({questions:t.questions,main_title:t.main_title,period:t.period}),t.period&&e.timeManager(t),e.renderFiles(),e.setState({fileInputs:e.fileInputs}),console.log(e.fileInputs)}))):console.log("ERROR: no url detected")},e.loadAttachmentQuestions=function(){j.firestore().collection("responses").doc(e.context.currentUser.uid).collection("answers").orderBy("date","desc").limit(1).get().then((function(t){t.forEach((function(t){console.log(t.id," => ",t.data()),t&&t.exists&&(e.setState({answers:t.data().answers}),e.setState({id:t.id}),e.downloadData(t.data().form_url))}))})),e.setState({showFileUpload:!0})},e.uploadFiles=function(t,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=j.storage().ref().child(e.context.currentUser.uid),o=t.target.files;Array.from(o).forEach((function(t){r.child(t.name).put(t).then((function(e){return e.ref.getDownloadURL()})).then((function(t){j.firestore().collection("responses").doc(e.context.currentUser.uid).collection("files").add({filepath:t,answer_number:n,answer_id:e.state.id,answer_subnumber:a}).catch((function(e){return alert(e)}))})).catch(console.error)}))},e.timeManager=function(t){var n=new Date,a=new Date(t.period.start),r=new Date(t.period.finish);a>n&&t.period.before.nofill||a<n&&n<r&&t.period.in.nofill||n>r&&t.period.after.nofill?e.setState({locked:!0}):e.setState({locked:!1}),console.log("LOCKED ",e.state.locked)},e.fileInputs=[],e.renderFiles=function(){e.state.questions.forEach((function(t,n){t.attachMaterials&&("multiradio"===t.type?e.state.answers[n]&&Object.keys(e.state.answers[n]).forEach((function(a){console.log(a),e.state.answers[n][a]===t.subquestion[a].on&&e.fileInputs.push({title:t.subquestion[a].q,index:n,subindex:a})})):e.fileInputs.push({title:t.title,index:n}))}))},e}return Object(i.a)(n,[{key:"componentDidMount",value:function(){this.loadAttachmentQuestions()}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement("h1",{className:"text-align-center"},this.state.main_title),this.fileInputs.map((function(t){var n=t.title,a=t.index.toString(),o=t.subindex?t.subindex.toString():null;return r.a.createElement("div",{key:o?a+"."+o:a},r.a.createElement("h5",null,n),r.a.createElement("input",{disabled:e.state.locked,type:"file",name:"filefield",multiple:"multiple",onChange:function(t){return e.uploadFiles(t,a,o)}}))})),this.state.showAnswers?r.a.createElement("p",{style:{textAlign:"left"}},"Full answers: ",JSON.stringify(this.state.answers)):null,this.state.showAnswers?r.a.createElement("p",{style:{textAlign:"left"}},"Short answers: ",JSON.stringify(this.state.shortAnswers)):null)}}]),n}(a.Component);V.contextType=y;var X=V,H=n(66),Z=function(){var e=Object(a.useState)([]),t=Object(b.a)(e,2),n=t[0],o=t[1],l=Object(a.useState)(""),s=Object(b.a)(l,2),i=(s[0],s[1]),c=Object(a.useState)(null),u=Object(b.a)(c,2),d=u[0],f=u[1],E=Object(a.useContext)(y).currentUser;Object(a.useEffect)((function(){var e=H.parse(window.location.search);console.log(e),i(e.url),e.url?fetch(e.url).then((function(e){return console.log("RESPONSE",e),e.json()})).then((function(e){console.log("DATA",e),o(e);var t=e.map(function(){var e=Object(w.a)(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t.url).then((function(e){return e.json()})).then((function(e){return e}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());Promise.all(t).then((function(e){return f(e)}))})):console.log("ERROR: no url detected")}),[]);return r.a.createElement(r.a.Fragment,null,d?r.a.createElement("div",null,r.a.createElement("button",{onClick:function(){return j.auth().signOut()}},"Sign out"),r.a.createElement("p",null,E.email),r.a.createElement(p.a,null,r.a.createElement("div",null,r.a.createElement("nav",null,r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(p.b,{to:"/ElectionsMonitoringForms/"+window.location.search},"Home")),n.map((function(e,t){return function(e){var t=new Date,n=new Date(e.period.start),a=new Date(e.period.finish);return!!(n>t&&e.period.before.nofill)||(!!(n<t&&t<a&&e.period.in.nofill)||!!(t>a&&e.period.after.nofill))}(d[t])?null:r.a.createElement("div",null,r.a.createElement("li",{key:t},r.a.createElement(p.b,{to:"/ElectionsMonitoringForms"+e.path+window.location.search},e.label)))})))),r.a.createElement(m.d,null,n.map((function(e,t){return r.a.createElement(m.b,{key:t,path:"/ElectionsMonitoringForms"+e.path},(function(){return r.a.createElement(K,{url:e.url,path:e.path,data:d[t]})}))})),r.a.createElement(m.b,{exact:!0,path:"/ElectionsMonitoringForms/files",component:Object(m.g)(X)}))))):null)},$=Object(m.g)((function(e){e.history;return Object(a.useContext)(y).currentUser?r.a.createElement(m.a,{to:"/ElectionsMonitoringForms/"+window.location.search}):r.a.createElement("div",null,r.a.createElement("h1",null,"Log in"),r.a.createElement("button",{onClick:O},"Sign-in with Google"))})),Y=Object(m.g)((function(e){var t=e.history;Object(a.useCallback)(function(){var e=Object(w.a)(h.a.mark((function e(n){var a,r,o;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),a=n.target.elements,r=a.email,o=a.password,e.prev=2,e.next=5,j.auth().createUserWithEmailAndPassword(r.value,o.value);case 5:t.push("/ElectionsMonitoringForms"),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),alert(e.t0);case 11:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(t){return e.apply(this,arguments)}}(),[t]);return r.a.createElement("div",null,r.a.createElement("h1",null,"Sign up"),r.a.createElement("button",{onClick:O},"Sign-in with Google"))})),ee=n(77),te=function(e){var t=e.component,n=Object(ee.a)(e,["component"]),o=Object(a.useContext)(y).currentUser;return r.a.createElement(m.b,Object.assign({},n,{render:function(e){return o?r.a.createElement(t,e):r.a.createElement(m.a,{to:"/ElectionsMonitoringForms/login"+window.location.search})}}))},ne=n(5),ae=n(163),re=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(i.a)(n,[{key:"render",value:function(){var e=this.props.classes;return r.a.createElement(ae.a,{container:!0,justify:"center"},r.a.createElement("div",{className:e.app},r.a.createElement(x,null,r.a.createElement(p.a,null,r.a.createElement("div",null,r.a.createElement(te,{exact:!0,path:"/ElectionsMonitoringForms/",component:Z}),r.a.createElement(m.b,{exact:!0,path:"/ElectionsMonitoringForms/login",component:$}),r.a.createElement(m.b,{exact:!0,path:"/ElectionsMonitoringForms/signup",component:Y}),r.a.createElement(m.b,{exact:!0,path:"/ElectionsMonitoringForms/files",component:Object(m.g)(X)}))))))}}]),n}(a.Component),oe=Object(ne.a)((function(e){var t;return{app:(t={padding:"10px"},Object(d.a)(t,e.breakpoints.down("sm"),{width:"100%"}),Object(d.a)(t,e.breakpoints.up("sm"),{width:"70%"}),Object(d.a)(t,e.breakpoints.up("md"),{width:"50%"}),t)}}),{withTheme:!0})(re);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(oe,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},58:function(e,t,n){},91:function(e,t,n){e.exports=n(124)},96:function(e,t,n){}},[[91,1,2]]]);
//# sourceMappingURL=main.431523e2.chunk.js.map